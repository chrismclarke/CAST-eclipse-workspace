package variance;import java.awt.*;import dataView.*;import models.*;public class PureComponentVariable extends CoreComponentVariable {	static final public int TOTAL = 0;	static final public int LINEAR = 1;	static final public int NONLIN = 2;	static final public int RESIDUAL = 3;		static final public Color kTotalColor = new Color(0x9900FF);			//	purple	static final public Color kLinearColor = Color.red;	static final public Color kNonlinColor = new Color(0x336600);	//	dark green	static final public Color kResidualColor = new Color(0x3333FF);		//	blue		static final public int kComponentType[] = {TOTAL, LINEAR, NONLIN, RESIDUAL};	static final public String kComponentKey[] = {"total_F", "linear_F", "nonlin_F", "residual_F"};	static final public Color kComponentColor[] = {kTotalColor, kLinearColor, kNonlinColor,																																	kResidualColor};		static public void addComponentsToData(CoreModelDataSet data, String xKey, String yKey,																			String xCatKey, String lsLinKey, String lsFactorKey) {		int decimals = data.getResponseDecimals();		for (int i=0 ; i<kComponentKey.length ; i++) {			String key = kComponentKey[i];			int type = kComponentType[i];			PureComponentVariable comp = new PureComponentVariable(key, data, xKey, yKey,																					xCatKey, lsLinKey, lsFactorKey, type, decimals);			data.addVariable(key, comp);		}	}		private int componentType;	private String xKey, xCatKey, lsFactorKey;		public PureComponentVariable(String theName, DataSet data, String xKey, String yKey,																	String xCatKey, String lsLinKey, String lsFactorKey,																	int componentType, int decimals) {		super(theName, data, yKey, lsLinKey, decimals);		this.componentType = componentType;		this.xKey = xKey;		this.xCatKey = xCatKey;		this.lsFactorKey = lsFactorKey;	}//--------------------------------------------------------		public int noOfValues() {		return Math.min(((Variable)data.getVariable(xKey)).noOfValues(),									super.noOfValues());	}		public boolean noteVariableChange(String key) {		return super.noteVariableChange(key) || xKey.equals(key);	}		public Value valueAt(int index) {		NumVariable yVar = (NumVariable)data.getVariable(yKey);		if (!foundYMean && (componentType == TOTAL || componentType == LINEAR))			getYMean();		double y = yVar.doubleValueAt(index);		double component;		if (componentType == TOTAL)			component = y - yMean;		else {			NumVariable xVar = (NumVariable)data.getVariable(xKey);			Value x = xVar.valueAt(index);			CatVariable xCatVar = (CatVariable)data.getVariable(xCatKey);			Value xCat = xCatVar.valueAt(index);			CoreModelVariable linModel = (CoreModelVariable)data.getVariable(modelKey);			CoreModelVariable factorModel = (CoreModelVariable)data.getVariable(lsFactorKey);			double linFit = linModel.evaluateMean(x);			double factorFit = factorModel.evaluateMean(xCat);			if (componentType == LINEAR)				component = linFit - yMean;			else if (componentType == NONLIN)				component = factorFit - linFit;			else				component = y - factorFit;		}		return new NumValue(component, decimals);	}		public int getDF() {		NumVariable yVar = (NumVariable)data.getVariable(yKey);		int n = yVar.noOfValues();		CatVariable xCatVar = (CatVariable)data.getVariable(xCatKey);		int nGroups = xCatVar.noOfCategories();		if (componentType == TOTAL)			return n - 1;		else if (componentType == LINEAR)			return 1;		else if (componentType == NONLIN)			return nGroups - 2;		else 			return n - nGroups;	}}